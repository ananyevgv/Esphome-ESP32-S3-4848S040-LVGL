image: !include images.yaml

#-------------------------------------------
#packages:
#  weather: !include 
#    file: packages/display/weather_anime.yaml
#    vars:
#      background_weather: back6
#      sensor_weather: weather.iaroslavskaia
#-------------------------------------------

substitutions:
  page_home: weather
  setting:            "\U0000e900" # setting
  term:               "\U0000e901" # термостат
  camera:             "\U0000e903" # камеры
  ha:                 "\U0000e90b" # home assistant
  wifi_25:            "\U0000e90e" # wifi signal from 25% to 1% F090E
  wifi_50:            "\U0000e90f" # wifi signal from 50% to 25% F090F
  wifi_75:            "\U0000e910" # wifi signal from 75% to 50% F0910
  wifi_100:           "\U0000e911" # wifi signal from 100% to 75% or disable F0911
  humidity:           "\U0000e912" # humidity
  co2:                "\U0000e913" # co2
  tvoc:               "\U0000e914" # air quality
  temperature:        "\U0000e915" # temperature
  vacuum:             "\U0000e918" # пылесос
  pressure:           "\U0000e9a6" # meter

  molecule_co2:       "\U000F07E4"
  gauge:              "\U000F029A"
  water_percent:      "\U000F058E"
  house_temp:         "\U000F0F55"
  temp:               "\U000F050F"
  monitor_dashboard:  "\U000F0A07"
  lock_open:          "\U000F0340"
  lock_outline:       "\U000F0341"
  checkbox_marked:    "\U000F0134"
  molecule:           "\U000F0BAC"
  
  sun_wireless:       "\U000F17FE"
  earth:              "\U000F01E7"
  flower_pollen:      "\U000F1885"
  grass:              "\U000F1510"
  tree_outline:       "\U000F0E69"
  
  #weather icons
  cloudy:             "\U000F0590"
  cloudyalert:        "\U000F0F2F"
  cloudyarrowright:   "\U000F0E6E"
  fog:                "\U000F0591"
  hail:               "\U000F0592"
  hazy:               "\U000F0F30"
  hurricane:          "\U000F0898"
  lightning:          "\U000F0593"
  lightningrainy:     "\U000F067E"
  night:              "\U000F0594"
  nightpartlycloudy:  "\U000F0F31"
  partlycloudy:       "\U000F0595"
  partlylightning:    "\U000F0F32"
  partlyrainy:        "\U000F0F33"
  partlysnowy:        "\U000F0F34"
  partlysnowyrainy:   "\U000F0F35"
  pouring:            "\U000F0596"
  rainy:              "\U000F0597"
  snowy:              "\U000F0598"
  snowyheavy:         "\U000F0F36"
  snowyrainy:         "\U000F067F"
  sunny:              "\U000F0599"
  sunnyalert:         "\U000F0F37"
  sunnyoff:           "\U000F14E4"
  sunset:             "\U000F059A"
  sunsetdown:         "\U000F059B"
  sunsetup:           "\U000F059C"
  tornado:            "\U000F0F38"
  windy:              "\U000F059D"
  windyvariant:       "\U000F059E"
  happyface:          "\U000F01F5"
  lan_disconnect:     "\U000F0319"



#-------------------------------------------
# FONT
#-------------------------------------------
font:
  - file: "gfonts://Roboto"
    id: weather_icons
    size: 110
    bpp: 4
    extras:
      - file: 'font/materialdesignicons-webfont.ttf' # http://materialdesignicons.com/cdn/7.4.47/ 
        glyphs: [
          $cloudy,
          $cloudyalert,
          $cloudyarrowright,
          $fog,
          $hail,
          $hazy,
          $hurricane,
          $lightning,
          $lightningrainy,
          $night,
          $nightpartlycloudy,
          $partlycloudy,
          $partlylightning,
          $partlyrainy,
          $partlysnowy,
          $partlysnowyrainy,
          $pouring,
          $rainy,
          $snowy,
          $snowyheavy,
          $snowyrainy,
          $sunny,
          $sunnyalert,
          $sunnyoff,
          $sunset,
          $sunsetdown,
          $sunsetup,
          $tornado,
          $windy,
          $windyvariant,    
          $happyface,
          $lan_disconnect
        ]

  - file: 'font/materialdesignicons-webfont.ttf' # http://materialdesignicons.com/cdn/7.4.47/ 
    id: icons_48
    size: 48
    bpp: 4
    glyphs: [
      $botton_icon0,
      $botton_icon1,
      $botton_icon2,
      $botton_icon3,
      $botton_icon4,
      $botton_icon5,
      $monitor_dashboard,
      $lock_open,
      $lock_outline
    ]   

  - file: "gfonts://Roboto"
    id: weather36
    size: 36
    bpp: 4
    extras:
      - file: 'font/materialdesignicons-webfont.ttf' # http://materialdesignicons.com/cdn/7.4.47/ 
        glyphs: [
          $earth,
          $windy,
          $sun_wireless
          ]

  - file: "gfonts://Roboto"
    id: weather24
    size: 24
    bpp: 4
    extras:
      - file: 'font/materialdesignicons-webfont.ttf' # http://materialdesignicons.com/cdn/7.4.47/ 
        glyphs: [
          $molecule_co2,
          $checkbox_marked,
          $molecule,
          $gauge,
          $water_percent,
          $house_temp,
          $temp,
          $flower_pollen,
          $grass,
          $windy,
          $tree_outline
          ]
          
  - file: "font/Icons.ttf"
    id: icons_24
    size: 24
    bpp: 4
    ignore_missing_glyphs: true
    glyphs: [
      $ha,
      $setting,
      $term,
      $camera,
      $vacuum,
      $wifi_25,
      $wifi_50,
      $wifi_75,
      $wifi_100
      ]
      
#-------------------------------------------
# GLOBAL
#-------------------------------------------    
globals:
  - id: child_protection
    type: bool
    restore_value: true
    initial_value: "false"    
#-------------------------------------------
# SENSOR
#------------------------------------------- 
sensor:
  - platform: homeassistant
    id: ha_weather_temp
    entity_id: $sensor_weather
    attribute: temperature
    on_value:
      then:
        - lvgl.label.update:
            id: display_temp
            text: 
              format: "%.0f °C"
              args: ["round(id(ha_weather_temp).state)"]  
            text_color: !lambda |-
              int8_t out_var = (id(ha_weather_temp).state);
              switch (out_var) {
                case -50 ... -26: return lv_color_hex(0x9670d6);
                case -25 ... -11: return lv_color_hex(0x4867aa);
                case -10 ... 0: return lv_color_hex(0x2fc0ff);
                case 1 ... 10: return lv_color_hex(0x00E6E6);
                case 11 ... 20: return lv_color_hex(0x00ddb8);
                case 21 ... 30: return lv_color_hex(0x00ff00);
                case 31 ... 40: return lv_color_hex(0xe7c12c);
                case 41 ... 50: return lv_color_hex(0xff0000);
                default: return lv_color_hex(0x333333);
              }
    
#-------------------------------------------
# TEXT SENSOR
#-------------------------------------------
text_sensor:
  # Sun horizon sensor from Home Assistant #
  - platform: homeassistant
    id: sun_state
    entity_id: sun.sun
    
  - platform: homeassistant
    id: weather_anime_state
    entity_id: $sensor_weather # Change the entity from your Home Assistant
    on_value: 
      then:
        - lambda: |-
            if (id(sun_state).state == "below_horizon" && (id(weather_anime_state).state == "cloudy" || id(weather_anime_state).state == "partlycloudy")) {
            lv_obj_clear_flag(id(weather_partlycloudy_moon), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_partlycloudy_moon), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(sun_state).state != "below_horizon" && id(weather_anime_state).state == "cloudy") {
            lv_obj_clear_flag(id(weather_cloudy), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_cloudy), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(sun_state).state != "below_horizon" && id(weather_anime_state).state == "partlycloudy") {
            lv_obj_clear_flag(id(weather_partlycloudy_sun), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_partlycloudy_sun), LV_OBJ_FLAG_HIDDEN);
            }
            if ((id(sun_state).state != "below_horizon" && id(weather_anime_state).state == "sunny") || (id(sun_state).state != "below_horizon" && id(weather_anime_state).state == "clear-night")) {
            lv_obj_clear_flag(id(weather_sunny), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_sunny), LV_OBJ_FLAG_HIDDEN);
            }
            if ((id(sun_state).state == "below_horizon" && id(weather_anime_state).state == "sunny") || (id(sun_state).state == "below_horizon" && id(weather_anime_state).state == "clear-night")) {
            lv_obj_clear_flag(id(weather_clear_night), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_clear_night), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "rainy") {
            lv_obj_clear_flag(id(weather_rainy), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_rainy), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "lightning-rainy") {
            lv_obj_clear_flag(id(weather_lightning_rainy), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_lightning_rainy), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "lightning") {
            lv_obj_clear_flag(id(weather_lightning), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_lightning), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "pouring") {
            lv_obj_clear_flag(id(weather_pouring), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_pouring), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "snowy") {
            lv_obj_clear_flag(id(weather_snowy), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_snowy), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "snowy-rainy") {
            lv_obj_clear_flag(id(weather_snowy_rainy), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_snowy_rainy), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "fog") {
            lv_obj_clear_flag(id(weather_fog), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_fog), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "hail") {
            lv_obj_clear_flag(id(weather_hail), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_hail), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "windy") {
            lv_obj_clear_flag(id(weather_windy), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_windy), LV_OBJ_FLAG_HIDDEN);
            }
            if (id(weather_anime_state).state == "windy-variant") {
            lv_obj_clear_flag(id(weather_windy_variant), LV_OBJ_FLAG_HIDDEN);
            } else {
            lv_obj_add_flag(id(weather_windy_variant), LV_OBJ_FLAG_HIDDEN);
            }


#-------------------------------------------
# LVGL
#-------------------------------------------
lvgl:
  pages:
    - id: weather
      scrollbar_mode: "OFF"
      scrollable: false
      bg_color: color_black
      widgets:
        # Wi-Fi status
        - label:
            id: wifi_status
            align: TOP_RIGHT
            x: -5
            y: 5
            text: "${wifi_100}"
            text_color: color_dark_gray
            text_font: icons_24

        # Home Assistant status
        - label:
            id: ha_status
            align: TOP_RIGHT
            x: -35
            y: 5
            text: "${ha}"
            text_color: color_dark_gray
            text_font: icons_24
            
        - label:
            align: CENTER
            id: display_weather_icon
            text: $happyface
            text_color: 0xFFFFFF
            bg_opa: TRANSP
            text_font: weather_icons
            y: -160
            x: -75
            

# Прогноз погоды
        - label:
            align: TOP_LEFT
            id: display_temp
            text: -- °C
            text_font: roboto36
            text_color: 0x808080
            y: 20
            x: 20
            
# WEATHER ICON  
        - animimg:
            id: weather_rainy
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ rainy0, rainy1, rainy2, rainy3, rainy4, rainy5, rainy6, rainy7, rainy8, rainy9, rainy10, rainy11]
            duration: 1200ms
        - animimg:
            id: weather_pouring
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ pouring0, pouring1, pouring2, pouring3, pouring4, pouring5, pouring6, pouring7, pouring8, pouring9, pouring10, pouring11 ]
            duration: 400ms
        - animimg:
            id: weather_lightning_rainy
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ lightning_rainy0, rainy1, lightning_rainy1, rainy3, rainy4, rainy5, rainy6, rainy7, rainy8, rainy9, rainy10, rainy11,
                    lightning_rainy2, rainy1, lightning_rainy3, rainy3, rainy4, rainy5, rainy6, rainy7, rainy8, rainy9, rainy10, rainy11
                  ]
            duration: 1500ms
        - animimg:
            id: weather_snowy_rainy
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ snowy_rainy0, snowy_rainy1, snowy_rainy2, snowy_rainy3, snowy_rainy4, snowy_rainy5, snowy_rainy6, snowy_rainy7, snowy_rainy8,
                    snowy_rainy9, snowy_rainy10, snowy_rainy11
                  ]
            duration: 1200ms
        - animimg:
            id: weather_snowy
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ snowy0, snowy1, snowy2, snowy3, snowy4, snowy5, snowy6, snowy7, snowy8, snowy9, snowy10, snowy11 ]
            duration: 1200ms
        - button:
            id: weather_sunny
            hidden: true
            pad_all: 0
            width: 100
            height: 100
            x: 20
            y: 70
            bg_opa: TRANSP
            shadow_opa: TRANSP
            widgets:
              - image:
                  src: sunny
        - button:
            id: weather_clear_night
            hidden: true
            pad_all: 0
            width: 100
            height: 100
            x: 20
            y: 70
            bg_opa: TRANSP
            shadow_opa: TRANSP
            widgets:
              - image:
                  src: clear_night
        - animimg:
            id: weather_hail
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ hail0, hail1, hail2, hail3, hail4, hail5, hail6, hail7, hail8, hail9, hail10, hail11 ]
            duration: 1200ms
        - animimg:
            id: weather_partlycloudy_sun
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ partlycloudy_sun0, partlycloudy_sun1, partlycloudy_sun2, partlycloudy_sun3, partlycloudy_sun4, partlycloudy_sun5, partlycloudy_sun6, 
                    partlycloudy_sun7, partlycloudy_sun6, partlycloudy_sun5, partlycloudy_sun4, partlycloudy_sun3, partlycloudy_sun2, partlycloudy_sun1 
                  ]
            duration: 2600ms
        - animimg:
            id: weather_partlycloudy_moon
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ partlycloudy_moon0, partlycloudy_moon1, partlycloudy_moon2, partlycloudy_moon3, partlycloudy_moon4, partlycloudy_moon5, partlycloudy_moon6,
                    partlycloudy_moon7, partlycloudy_moon6, partlycloudy_moon5, partlycloudy_moon4, partlycloudy_moon3, partlycloudy_moon2, partlycloudy_moon1 
                  ]
            duration: 2600ms
        - animimg:
            id: weather_windy
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ windy0, windy1, windy2, windy3, windy2, windy1 ]
            duration: 1000ms
        - animimg:
            id: weather_windy_variant
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ windy_variant0, windy_variant1, windy_variant2, windy_variant3, windy_variant2, windy_variant1 ]
            duration: 1000ms
        - animimg:
            id: weather_lightning
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ lightning0, lightning1, lightning1, lightning1, 
                    lightning0, lightning1, lightning1, lightning1, 
                    lightning1, lightning1, lightning1, lightning1, 
                    lightning2, lightning3, lightning3, lightning3, 
                    lightning2, lightning3, lightning3, lightning3, 
                    lightning3, lightning3, lightning3, lightning3, 
                    lightning3, lightning3, lightning3, lightning3, 
                    lightning3, lightning3, lightning3, lightning3
                  ]
            duration: 2000ms
        - animimg:
            id: weather_fog
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ fog0, fog1, fog2, fog3, fog4, fog5, fog6, fog7, fog8, fog9, fog10, fog11, fog12, fog11, fog10, fog9, fog8, fog7, fog6, fog5, fog4, fog3, fog2, fog1 ]
            duration: 5000ms
        - animimg:
            id: weather_cloudy
            hidden: true
            x: 20
            y: 70
            align: TOP_LEFT
            src: [ cloudy0, cloudy1, cloudy2, cloudy3, cloudy2, cloudy1 ]
            duration: 600ms

# Страницы
        - obj:
            bg_opa: TRANSP
            border_opa: TRANSP
            width: 240 #110
            height: 270
            align: CENTER
            x: 130 #70 
            y: 80
            layout:
              pad_row: 20
              pad_column: 20
              type: GRID
              grid_columns: [FR(1), FR(1)]
              grid_rows: [FR(1), FR(1), FR(1)]
            widgets:
              - button:
                  bg_color: color_black
                  shadow_color: $collor_page0
                  shadow_spread: 2
                  shadow_width: 25
                  shadow_opa: 100%
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        align: CENTER
                        text_font: icons_48
                        text_color: $collor_page0
                        text: $botton_icon0
                  on_press:
                    then:
                      - lvgl.page.show: 
                          id: $botton_page0
                          animation: OUT_RIGHT
                          time: 300ms

              - button:
                  bg_color: color_black
                  shadow_color: $collor_page1
                  shadow_spread: 2
                  shadow_width: 25
                  shadow_opa: 100%
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        align: CENTER
                        text_font: icons_48
                        text_color: $collor_page1
                        text: $botton_icon1
                  on_press:
                    then:
                      - lvgl.page.show: 
                          id: $botton_page1
                          animation: OUT_RIGHT
                          time: 300ms
              - button:
                  bg_color: color_black
                  shadow_color: $collor_page2
                  shadow_spread: 2
                  shadow_width: 25
                  shadow_opa: 100%
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        align: CENTER
                        text_font: icons_48
                        text_color: $collor_page2
                        text: $botton_icon2
                  on_press:
                    then:
                      - lvgl.page.show: 
                          id: $botton_page2
                          animation: OUT_RIGHT
                          time: 300ms
                          
              - button:
                  bg_color: color_black
                  shadow_color: $collor_page3
                  shadow_spread: 2
                  shadow_width: 25
                  shadow_opa: 100%
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        align: CENTER
                        text_font: icons_48
                        text_color: $collor_page3
                        text: $botton_icon3
                  on_press:
                    then:
                      - lvgl.page.show: 
                          id: $botton_page3
                          animation: OUT_RIGHT
                          time: 300ms

              - button:
                  bg_color: color_black
                  shadow_color: $collor_page4
                  shadow_spread: 2
                  shadow_width: 25
                  shadow_opa: 100%
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        align: CENTER
                        text_font: icons_48
                        text_color: $collor_page4
                        text: $botton_icon4
                  on_press:
                    then:
                      - lvgl.page.show: 
                          id: $botton_page4
                          animation: OUT_RIGHT
                          time: 300ms

              - button:
                  bg_color: color_black
                  shadow_color: $collor_page5
                  shadow_spread: 2
                  shadow_width: 25
                  shadow_opa: 100%
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        align: CENTER
                        text_font: icons_48
                        text_color: $collor_page5
                        text: $botton_icon5
                  on_press:
                    then:
                      - lvgl.page.show: 
                          id: $botton_page5
                          animation: OUT_RIGHT
                          time: 300ms
                          
        # Child protection placeholder
        - button:
            id: child_protection_placeholder
            clickable: true
            hidden: true
            width: 480
            height: 480
            bg_opa: TRANSP
            border_opa: TRANSP
            shadow_opa: TRANSP
            
        # CHILD PROTECTION WIDGET
        - button:
            x: -30
            y: 40
            width: 70
            height: 70
            bg_opa: TRANSP
            shadow_opa: TRANSP
            align: TOP_RIGHT
            widgets:
              - label:
                  id: child_protection_status
                  align: CENTER
                  text_font: icons_48
                  text_color: color_gray
                  text: "${lock_open}"
            on_long_press:
              then:
                - if:
                    condition:
                      lambda: 'return id(child_protection) == false;'
                    then:
                      - lambda: |-
                          id(child_protection) = !id(child_protection); 
                      - lvgl.widget.show: child_protection_placeholder
                      - lvgl.widget.hide: top_layer
                      - lvgl.label.update:
                          id: child_protection_status
                          text: "${lock_outline}"
                          text_color: color_green
                    else:
                      - lambda: |-
                          id(child_protection) = !id(child_protection); 
                      - lvgl.widget.hide: child_protection_placeholder
                      - lvgl.widget.show: top_layer
                      - lvgl.label.update:
                          id: child_protection_status
                          text: "${lock_open}"
                          text_color: color_dark_gray